(function(){document.addEventListener("DOMContentLoaded",function(e){const t=new WOW({boxClass:"loading-animate",animateClass:"animated",offset:0,mobile:true});t.init();const o=document.documentElement;const n=document.body;const s=e=>{const t=document.querySelectorAll(e);if(t.length===0){return}const o=t[0];const n=o.querySelector("img").offsetWidth;const s=o.querySelector("img").offsetHeight;t.forEach(e=>{e.querySelector("img").style.width=n+"px";e.querySelector("img").style.height=s+"px"})};const a=document.querySelectorAll(".dropdown");a.forEach(e=>{e.addEventListener("mouseover",()=>{e.querySelector(".dropdown-menu").classList.add("show")});e.addEventListener("mouseout",()=>{e.querySelector(".dropdown-menu").classList.remove("show")})});const r=document.body.clientWidth;const c=document.querySelector("#site-header");const i=document.querySelector("#offcanvasMenu");if(r<992){i.style.top=parseFloat(getComputedStyle(document.documentElement).marginTop)+"px"}let l=new LazyLoad({elements_selector:".lazy",threshold:0});if(l){l.update()}if("undefined"!==typeof hljs){document.querySelectorAll("pre code").forEach(e=>{hljs.highlightBlock(e)})}let d=document.getElementById("scroll-up");d.addEventListener("click",e=>{e.preventDefault();x({timing:e=>o.scrollTop=o.scrollTop*(1-e),draw:e=>1-Math.sin(Math.acos(e)),duration:700})});const m=document.querySelector(".like-button");const u=document.querySelector(".count");if(m){let a=m.dataset.id;let e=localStorage.getItem(`post_like_${a}`);let r=false;if(e){u.textContent=e;m.classList.add("done");m.disabled=true}m.addEventListener("click",j(async e=>{e.preventDefault();if(r){return}let t=new URLSearchParams({action:"post_like",security:adminajax.nonce,post_ID:a});try{const o=await fetch(adminajax.url,{method:"POST",body:t});const{success:n,data:s}=await o.json();if(n&&typeof s==="number"){localStorage.setItem(`post_like_${a}`,s);u.textContent=s;r=true}else{console.log(s)}}catch(e){console.error(e)}finally{m.classList.add("done");m.disabled=true}},500))}const f=document.getElementById("commentform");const p=e=>{message.innerHTML=`<strong><i class="fa fa-ok me-1"></i>${e}</strong>`;message.classList.add("shake","show");setTimeout(()=>message.classList.remove("shake","show"),3e3)};const y=e=>{message.innerHTML=`<strong><i class="fa fa-xmark me-1"></i>${e}</strong>`;message.classList.add("show");setTimeout(()=>message.classList.remove("show"),3e3)};if(f){f.insertAdjacentHTML("beforeend",'<div id="message" class="text-danger wow"></div>');const message=f.querySelector("#message");const h=f.querySelector('[name="author"]');const g=f.querySelector('[name="email"]');const S=f.querySelector('[name="url"]');const w=f.querySelector('[name="comment"]');f.addEventListener("click",async e=>{if(e.target.type==="submit"&&e.target.closest("#commentform")){e.preventDefault();message.removeAttribute("style");message.classList.remove("shake","fadeOut");message.innerHTML='<strong><i class="fa fa-spinner fa-pulse me-1"></i>正在提交...</strong>';(new WOW).init();if(!adminajax.loggedin){const o={author:h.value,email:g.value,url:S.value};if(!o.author){p("请填写姓名");return}if(!q(o.email)){p("请填写正确的电子邮箱");return}}if(!w.value){p("请输入评论内容");return}const t=new URLSearchParams(new FormData(f));t.append("action","ajax_comment");t.append("security",adminajax.nonce);try{const n=await fetch(adminajax.url,{method:"POST",body:t});const{success:s,data:a}=await n.json();if(s&&a.length!==0){const r=b(a);const c=r[1];const i=document.getElementById("respond");e.target.setAttribute("disabled","disabled");if(i.parentNode.classList.contains("comment")){i.previousElementSibling?.appendChild(c)??i.parentNode.appendChild(c)}else if(document.querySelector(".comment-list")){document.querySelector(".comment-list").insertBefore(c,document.querySelector(".comment-list").firstChild)}else{i.parentNode.insertAdjacentHTML("beforeend",`
						<div class="card mb-3">
							<ol class="comment-list p-0 m-0 list-group list-group-flush">
								${c.outerHTML}
							</ol>
						</div>
					`)}y("评论已成功提交");f.querySelector("#comment").value=""}else{p("评论提交失败，请刷新后重试");console.error(a)}}catch(e){p("评论提交失败，请刷新后重试！");console.log(e)}finally{e.target.removeAttribute("disabled");setTimeout(()=>message.classList.remove("show"),3e3)}}})}L();v()});function e(e){if(typeof e!=="function"){return}if(document.readyState==="interactive"||document.readyState==="complete"){return e()}document.addEventListener("DOMContentLoaded",e,false)}e(function(){});const L=()=>{const c=document.querySelector(".more-posts");const i=document.querySelector(".ajax-posts");if(c===null){console.error("Can't find element with class '.more-posts'");return}if(typeof c!="undefined"&&c!=null){c.addEventListener("click",j(async e=>{e.preventDefault();c.innerHTML=adminajax.loading;let t=i.dataset.page;let o=i.dataset.max;let n=new URLSearchParams({action:"load_more",query:adminajax.posts,security:adminajax.nonce,current_page:t,max_pages:o});try{const s=await fetch(adminajax.url,{method:"POST",body:n});const{success:a,data:r}=await s.json();if(a&&r.length!==0){let e=b(r);i.dataset.page++;e.forEach(e=>{i.appendChild(e)});c.textContent=adminajax.loadmore;c.blur()}else{c.textContent=adminajax.noposts;c.blur();c.disabled=true;c.setAttribute("aria-disabled","true")}}catch(e){console.error(e);c.textContent="出错啦，请刷新";c.disabled=true;c.setAttribute("aria-disabled","true")}},500))}};const v=()=>{const e=document.querySelector("#wp-calendar");if(e===null){console.error("Can't find element with id '#wp-calendar'");return}const t=e.querySelectorAll("tbody td a");t.forEach(e=>{e.classList.add("has-posts")})};const b=e=>{const t=document.createElement("div");if(typeof e==="string"){t.innerHTML=e}return Array.from(t.childNodes)};const t=function(e,t){return(e.matches||e.matchesSelector||e.msMatchesSelector||e.mozMatchesSelector||e.webkitMatchesSelector||e.oMatchesSelector).call(e,t)};const o=o=>{o.style.opacity=0;let n=0;const s=400;const a=performance.now();function r(e){const t=e-a;n=Math.min(1,n+t/s);o.style.opacity=n;if(n<1){window.requestAnimationFrame&&requestAnimationFrame(r)||setTimeout(()=>r(performance.now()),16)}}r(a)};const q=e=>{const t=/^[\w-\.]+@([\w-]+\.)+[\w-]{2,}$/;return t.test(e)};let x=n=>{let s=performance.now();let a=e=>{let t=(e-s)/n.duration;if(t>1)t=1;let o=n.timing(t);n.draw(o);if(t<1){requestAnimationFrame(a)}};requestAnimationFrame(a)};function j(t,o){let n;return function(...e){clearTimeout(n);n=setTimeout(()=>{t.apply(this,e)},o)}}})();