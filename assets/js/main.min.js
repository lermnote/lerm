(()=>{"use strict";class e{constructor(e){this.apiUrl=e}fetchData=async({url:e,method:t="GET",body:a={},headers:r={}})=>{r={method:t,headers:{...r},body:"GET"!==t?a:null};try{var s=await fetch(e,r);if(s.ok)return await s.json();throw Error("HTTP error! Status: "+s.status)}catch(e){throw"AbortError"!==e.name&&this.handleError(e),e}};handleError=e=>{alert("An error occurred: "+e.message)};rateLimit=(s,o,i=!1)=>{let n,c=0;return(...e)=>{const t=this;var a=Date.now(),r=o-(a-c);i&&r<=0?(clearTimeout(n),n=null,c=a,s.apply(t,e)):n=n||setTimeout(()=>{n=null,i||s.apply(t,e)},i?r:o)}};displayMessage=(e,t="info",a=5e3)=>{if(this.messageId){const r=document.getElementById(this.messageId);r&&(r.innerHTML=e,r.classList.add("text-"+t),r.classList.remove("invisible"),clearTimeout(this.messageTimeout),this.messageTimeout=setTimeout(()=>{r.classList.add("invisible"),r.classList.remove("text-"+t)},a))}};toggleButton=(e,t,a=!1)=>{t?e.insertAdjacentHTML("afterbegin",'<span class="spinner-border spinner-border-sm" aria-hidden="true"></span> '):(t=document.querySelector(".spinner-border"))&&t.remove(),a||e.removeAttribute("disabled")}}const l=(e,a,r)=>{document.addEventListener(e,e=>{var t=e.target.closest(a);t&&t.matches(a)&&(e.preventDefault(),r(e,t))})};class t extends e{constructor({apiUrl:e,selector:t,action:a,security:r,headers:s={},additionalData:o={},isThrottled:i=!1,cacheExpiryTime:n=6e4,enableCache:c=!0}){super(e),Object.assign(this,{selector:t,action:a,security:r,headers:s,additionalData:o,cacheExpiryTime:n,enableCache:c}),this.clickHandler=i?this.rateLimit(this.handleClick,1e3,!0):this.handleClick,l("click",this.selector,this.clickHandler)}handleClick=async(e,t)=>{e.preventDefault(),this.beforeClick(e);var e=new URLSearchParams({action:this.action,security:this.security,...t.dataset,...this.additionalData}),a="click_action_"+this.selector;if(this.enableCache&&this.isCacheValid(a))this.useCache(a);else{this.toggleButton(t,!0);try{var r=await this.fetchData({url:this.apiUrl,method:"POST",body:e.toString(),headers:{"Content-Type":"application/x-www-form-urlencoded",...this.headers}});if(!r.success)throw Error(r.data||"Unknown error occurred");this.onSuccess(r.data,t),this.enableCache&&this.updateCache(a,r)}catch(e){this.onError(e,t)}this.toggleButton(t,!1)}};isCacheValid=e=>{var t=sessionStorage.getItem(e),e=sessionStorage.getItem(e+"_time");return t&&Date.now()-e<this.cacheExpiryTime};useCache(e){e=JSON.parse(sessionStorage.getItem(e));this.onSuccess(e)}cacheResponse=(e,t)=>{localStorage.setItem(e,JSON.stringify(t)),localStorage.setItem(e+"_time",Date.now())};updateCache(e,t){sessionStorage.setItem(e,JSON.stringify(t)),sessionStorage.setItem(e+"_time",Date.now())}beforeClick=()=>{};onSuccess=(e,t)=>{this.displayMessage("Click action was successful!")};onError=(e,t)=>{this.displayMessage("Failed to process click action."),t.setAttribute("disabled","disabled"),t.innerHTML=e.message}}const a=(e,t)=>{var{id:t,type:a}=t.dataset,a=document.querySelectorAll(`.like-${a}-`+t);const r=e.status,s=e.count;a.forEach(e=>{e.classList.toggle("liked","liked"===r),e.querySelector(".count").textContent=s,e.setAttribute("title","liked"===r?"unlike":"like")})},r=e=>{var t=document.querySelector(".more-posts"),a=document.querySelector(".ajax-posts");a&&a.insertAdjacentHTML("beforeend",e.content),t.dataset.currentPage=e.currentPage};class s extends e{constructor({apiUrl:e,formId:t,action:a,security:r,headers:s={},messageId:o,passwordToggle:i=!1}){super(e),Object.assign(this,{formId:t,action:a,security:r,headers:s,messageId:o,passwordToggle:i}),this.init()}init=()=>{var e=document.getElementById(this.formId);if(e&&(l("submit","#"+this.formId,(e,t)=>{this.handleFormSubmit(e,t)}),this.passwordToggle)){const a=document.getElementById(this.formId+"-toggle"),r=Array.from(document.querySelectorAll('input[type="password"]'));a?.addEventListener("click",()=>{return e=r,t=a,e.forEach(e=>{var t="password"===e.type;e.type=t?"text":"password"}),void(t.innerText="password"===e[0].type?"show":"hide");var e,t})}};handleFormSubmit=async(e,t)=>{if(e.preventDefault(),this.validateForm(t)){e=t.querySelector('button[type="submit"]');if(!e.disabled){this.toggleButton(e,!0);var a=new FormData(t);a.append("action",this.action),a.append("security",this.security),this.beforeSubmit();try{var r=await this.fetchData({url:this.apiUrl,method:"POST",body:a,headers:this.headers});if(!r.success)throw Error(r||"Unknown error occurred");this.onSuccess(r,t)}catch(e){this.onError(e)}finally{this.toggleButton(e,!1)}}}};validateForm(e){var t=e.checkValidity();return t||e.reportValidity(),t}beforeSubmit=()=>{};afterSubmit(e){}onSuccess=(e,t)=>{t.reset(),this.afterSubmitSuccess(e.data),this.displayMessage("Form submitted successfully!","success")};afterSubmitSuccess=e=>{};onError(e){this.messageId&&this.displayMessage(e.message,"danger")}}const o=e=>{var t,a,r=document.getElementById("respond"),s=document.querySelector(".comment-list"),e=(e.comment.comment_parent,`
        <li class="${(e=e.comment).comment_type} list-group-item${"0"!==e.comment_parent?" p-0":""}" id="comment-${e.comment_ID}">
            <article id="div-comment-${e.comment_ID}" class="comment-body">
                <footer class="comment-meta mb-1">
                    <span class="comment-author vcard">
                        <img src="${e.avatar_url}" srcset="${e.avatar_url} 2x"
                             alt="${e.comment_author}" class="avatar avatar-${e.avatar_size} photo"
                             height="${e.avatar_size}" width="${e.avatar_size}" loading="lazy" decoding="async">
                        <b class="fn">${e.comment_author}</b>
                    </span>
                    <span class="comment-metadata">
                        <span aria-hidden="true">•</span>
                        <a href="http://localhost/wordpress/${e.comment_post_ID}/#comment-${e.comment_ID}">
                            <time datetime="${e.comment_date_gmt}">${e.comment_date}</time>
                        </a>
                    </span>
                </footer>
                ${"0"===e.comment_approved?`
                    <span class="comment-awaiting-moderation badge rounded-pill bg-info">
                        您的评论正在等待审核。
                    </span>`:""}
                <section class="comment-content" style="margin-left: 56px">
                    <p>${e.comment_content}</p>
                </section>
            </article>
        </li>`);s?(a=r.previousElementSibling)?(t=a.lastElementChild)&&t.classList.contains("children")?t.insertAdjacentHTML("beforeend",e):((t=document.createElement("ul")).classList.add("children"),t.innerHTML=e,a.appendChild(t)):s.insertAdjacentHTML("afterbegin",e):((a=document.createElement("div")).classList.add("card","mb-3"),a.innerHTML=`
				<ol class="comment-list p-0 m-0 list-group list-group-flush">
					${e}
				</ol>`,r.parentNode.appendChild(a))},i=()=>{loadPage(lermData.frontDoor)},n=()=>{loadPage(lermData.redirect)},c=()=>{var e=[{formId:"login",action:lermData.login_action,security:lermData.login_nonce},{formId:"reset",action:lermData.reset_action,security:lermData.reset_nonce},{formId:"regist",action:lermData.regist_action,security:lermData.regist_nonce,passwordToggle:!0},{formId:"commentform",action:lermData.comment_action,security:lermData.nonce}];lermData.loggedin&&e.push({formId:"update-profile",action:lermData.profile_action,security:lermData.profile_nonce}),e.forEach(e=>{var t;document.getElementById(e.formId)&&(t=new s({...e,apiUrl:lermData.url,messageId:e.formId+"-msg"}),"commentform"===e.formId&&(t.afterSubmitSuccess=o),"login"===e.formId&&(t.afterSubmitSuccess=i),"update-profile"===e.formId)&&(t.afterSubmitSuccess=n)})};const d=()=>{l("click","#scroll-up",e=>{e.preventDefault(),document.documentElement.scrollIntoView({behavior:"smooth"})})},m=(()=>{let t;return()=>{t=t||new IntersectionObserver((e,t)=>{e.forEach(e=>{e.isIntersecting&&((e=e.target).src=e.dataset.src,t.unobserve(e))})},{rootMargin:"0px 0px",threshold:0}),document.querySelectorAll(".lazy").forEach(e=>t.observe(e))}})();var h;const u=(e,t)=>{let a=1;const r=50/t,s=setInterval(()=>{(a-=r)<=.5&&(clearInterval(s),a=.5),e.style.opacity=a},50)},p=(e,t)=>{let a=.5;const r=50/t,s=setInterval(()=>{1<=(a+=r)&&(clearInterval(s),a=1),e.style.opacity=a},50)},g=new class extends e{constructor({apiUrl:e,containerId:t,ignoreUrls:a=[],errorText:r="An error occurred while loading content."}){super(e),this.containerId=t,this.ignoreUrls=a,this.errorText=r,this.state={ajaxLoading:!1,ajaxStarted:!1}}init(){this.bindLinkClicks(e=>this.shouldInterceptLink(e),e=>this.loadPage(e)),this.bindSearchForm('form[method="GET"]',(e,t)=>this.loadPage(e,!1,t)),window.onpopstate=()=>this.handlePopState()}bindLinkClicks=(a,r)=>{l("click","a",(e,t)=>{a&&a(t)&&(e.preventDefault(),r(t.href))})};bindSearchForm=(e,a)=>{l("submit",e,(e,t)=>{e.preventDefault();e=new URLSearchParams(new FormData(t)).toString();a(t.action,e)})};handlePopState(){this.state.ajaxStarted&&!this.isIgnoredUrl(window.location.href)&&this.loadPage(window.location.href,!0)}shouldInterceptLink(e){return e.href.includes(window.location.origin)&&!this.isIgnoredUrl(e.href)&&!this.state.ajaxLoading}async loadPage(e,t=!1,a=null){if(!this.state.ajaxLoading){this.state.ajaxLoading=!0;var r=document.getElementById(this.containerId);if(r){!t&&history.pushState&&history.pushState({},"",new URL(a?e+"?"+a:e,window.location.origin).href),u(r);try{var s=a?e+"?"+a:e,o=await this.fetchData({url:this.apiUrl+"?action=load_page_content&url="+encodeURIComponent(s),method:"GET"});if(!o.success)throw Error(o.message||this.errorText);this.updatePageContent(r,o.data),p(r),window.scrollTo({top:0,behavior:"smooth"})}catch(e){this.displayError(r)}finally{this.state.ajaxLoading=!1}}else this.state.ajaxLoading=!1}}updatePageContent(e,t){document.title=t.title||document.title,this.updateMeta("description",t.meta_description),this.updateMeta("keywords",t.meta_keywords),e.innerHTML=t.content||"",document.dispatchEvent(new Event("contentLoaded"))}updateMeta(t,a){if(a){let e=document.querySelector(`meta[name="${t}"]`);e||((e=document.createElement("meta")).setAttribute("name",t),document.head.appendChild(e)),e.setAttribute("content",a)}}isIgnoredUrl(t){return this.ignoreUrls.some(e=>t.includes(e))}displayError(e,t){p(e),e.innerHTML=`<p class="text-danger">${t}</p>`}}({apiUrl:lermData.url,containerId:"page",ignoreUrls:["/page/"],errorText:"Failed to load the content. Please try again later."});h=()=>{var e;g.init(),requestIdleCallback(()=>{var e,t;new WOW({boxClass:"loading-animate",animateClass:"animated",offset:0,mobile:!0,live:!0}).init(),m(),"undefined"!=typeof hljs&&document.querySelectorAll("pre code").forEach(e=>{hljs.highlightBlock(e)}),document.querySelector("#wp-calendar")&&0!==(e=document.querySelectorAll("tbody td a")).length&&e.forEach(e=>{e.classList.add("has-posts")}),e=document.body.clientWidth,t=document.querySelector("#offcanvasMenu"),e<992&&(t.style.top=parseFloat(getComputedStyle(document.documentElement).marginTop)+"px"),l("click",".navbar-toggler",(e,t)=>{t.classList.toggle("active")})}),d(),e={selector:".like-button",action:"post_like",security:lermData.like_nonce,apiUrl:lermData.url,isThrottled:!0,cacheExpiryTime:6e4,enableCache:!1},new t(e).onSuccess=a,new t({selector:".more-posts",action:"load_more",security:lermData.nonce,apiUrl:lermData.url,isThrottled:!0,cacheExpiryTime:6e4,enableCache:!1}).onSuccess=r,c()},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",h,{once:!0}):h(),document.addEventListener("contentLoaded",()=>{d(),c()})})();